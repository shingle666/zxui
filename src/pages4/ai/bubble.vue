<template>
  <view class="bubble-demo">
    <view class="demo-section">
      <view class="section-title">åŸºç¡€ç”¨æ³•</view>
      <zx-ai-bubble content="Hello! è¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„AIå¯¹è¯æ°”æ³¡ã€‚" />
      <zx-ai-bubble 
        content="è¿™æ˜¯ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚" 
        placement="end"
        :avatar="{ text: 'U', bgColor: '#52c41a', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">å¤´åƒå’Œä½ç½®</view>
      <zx-ai-bubble 
        content="æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼" 
        :avatar="{ src: '/static/ai-avatar.png', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="è°¢è°¢ä½ çš„å¸®åŠ©ï¼" 
        placement="end"
        :avatar="{ text: 'å¼ ', bgColor: '#f56a00', color: '#fff', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="æˆ‘å¯ä»¥ä½¿ç”¨å›¾æ ‡å¤´åƒï¼" 
        :avatar="{ icon: 'home', bgColor: '#1890ff', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="æ–¹å½¢å¤´åƒä¹Ÿå¾ˆé…·ï¼" 
        placement="end"
        :avatar="{ text: 'ME', shape: 'square', bgColor: '#52c41a', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">åŠ è½½çŠ¶æ€</view>
      <zx-ai-bubble 
        :loading="loading"
        content="æ­£åœ¨æ€è€ƒä¸­..." 
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
      <view class="demo-controls">
        <button @click="toggleLoading" class="demo-button">
          {{ loading ? 'åœæ­¢åŠ è½½' : 'å¼€å§‹åŠ è½½' }}
        </button>
      </view>
    </view>

    <view class="demo-section">
      <view class="section-title">æ‰“å­—æ•ˆæœ</view>
      <zx-ai-bubble 
        :content="typingText"
        :typing="{ step: 2, interval: 100, suffix: 'âœ¨' }"
        :avatar="{ text: 'AI', size: '80rpx' }"
        @typing-complete="onTypingComplete"
      />
      <view class="demo-controls">
        <button @click="startTyping" class="demo-button">å¼€å§‹æ‰“å­—</button>
        <button @click="extendText" class="demo-button">æ‰©å±•æ–‡æœ¬</button>
      </view>
    </view>

    <view class="demo-section">
      <view class="section-title">å¤´éƒ¨å’Œåº•éƒ¨</view>
      <zx-ai-bubble 
        content="è¿™æ¡æ¶ˆæ¯åŒ…å«å¤´éƒ¨å’Œåº•éƒ¨ä¿¡æ¯ã€‚"
        header="AIåŠ©æ‰‹ Â· åˆšåˆš"
        footer="æ¶ˆæ¯å·²é€è¾¾"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">ä¸åŒå˜ä½“</view>
      <zx-ai-bubble 
        content="å¡«å……æ ·å¼ï¼ˆé»˜è®¤ï¼‰"
        variant="filled"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="è¾¹æ¡†æ ·å¼"
        variant="outlined"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="æ— è¾¹æ¡†æ ·å¼"
        variant="borderless"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="é˜´å½±æ ·å¼"
        variant="shadow"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">ä¸åŒå½¢çŠ¶</view>
      <zx-ai-bubble 
        content="åœ†è§’å½¢çŠ¶"
        shape="round"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
      <zx-ai-bubble 
        content="ç›´è§’å½¢çŠ¶"
        shape="corner"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">è‡ªå®šä¹‰æ¸²æŸ“</view>
      <zx-ai-bubble 
        :content="markdownContent"
        :message-render="renderMarkdown"
        :avatar="{ text: 'AI', size: '80rpx' }"
      />
    </view>

    <view class="demo-section">
      <view class="section-title">æ’æ§½ç”¨æ³•</view>
      <zx-ai-bubble 
        content="è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æ’æ§½çš„ç¤ºä¾‹"
        header="è‡ªå®šä¹‰å¤´éƒ¨"
      >
        <template #avatar>
          <view class="custom-avatar">ğŸ¤–</view>
        </template>
        <template #header>
          <view class="custom-header">
            <text class="header-name">æ™ºèƒ½åŠ©æ‰‹</text>
            <text class="header-time">{{ currentTime }}</text>
          </view>
        </template>
        <template #footer="{ content }">
          <view class="custom-footer">
            <text class="footer-info">å­—æ•°ï¼š{{ content.length }}</text>
            <text class="footer-status">å·²è¯»</text>
          </view>
        </template>
      </zx-ai-bubble>
    </view>

    <view class="demo-section">
      <view class="section-title">å¯¹è¯åˆ—è¡¨</view>
      <view class="chat-list">
        <zx-ai-bubble 
          v-for="(message, index) in chatMessages"
          :key="index"
          :content="message.content"
          :placement="message.placement"
          :avatar="message.avatar"
          :typing="message.typing"
          :loading="message.loading"
          @typing-complete="() => onMessageTypingComplete(index)"
        />
      </view>
      <view class="demo-controls">
        <button @click="addMessage" class="demo-button">æ·»åŠ æ¶ˆæ¯</button>
        <button @click="clearMessages" class="demo-button">æ¸…ç©ºæ¶ˆæ¯</button>
      </view>
    </view>
  </view>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import zxAiBubble from '@tanzhenxing/zx-ai-bubble/zx-ai-bubble.vue'

// å“åº”å¼æ•°æ®
const loading = ref(false)
const typingText = ref('')
const currentTime = ref('')
const chatMessages = ref([])

// è®¡ç®—å±æ€§
const markdownContent = computed(() => {
  return '**ç²—ä½“æ–‡æœ¬** å’Œ *æ–œä½“æ–‡æœ¬*\n\n- åˆ—è¡¨é¡¹ 1\n- åˆ—è¡¨é¡¹ 2\n- åˆ—è¡¨é¡¹ 3'
})

// æ–¹æ³•
const toggleLoading = () => {
  loading.value = !loading.value
}

const startTyping = () => {
  typingText.value = 'Hello! è¿™æ˜¯ä¸€ä¸ªæ‰“å­—æ•ˆæœçš„æ¼”ç¤ºã€‚æˆ‘ä¼šä¸€ä¸ªå­—ä¸€ä¸ªå­—åœ°æ˜¾ç¤ºå‡ºæ¥ï¼Œå°±åƒçœŸäººåœ¨æ‰“å­—ä¸€æ ·ã€‚'
}

const extendText = () => {
  typingText.value += ' è¿™æ˜¯æ‰©å±•çš„æ–‡æœ¬å†…å®¹ï¼Œä¼šç»§ç»­æ‰“å­—æ˜¾ç¤ºã€‚'
}

const onTypingComplete = () => {
  console.log('æ‰“å­—æ•ˆæœå®Œæˆ')
  uni.showToast({
    title: 'æ‰“å­—å®Œæˆ',
    icon: 'success'
  })
}

const renderMarkdown = (content) => {
  // ç®€å•çš„ Markdown æ¸²æŸ“ç¤ºä¾‹
  return content
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/\n/g, '<br>')
    .replace(/^- (.*)/gm, 'â€¢ $1')
}

const updateTime = () => {
  const now = new Date()
  currentTime.value = now.toLocaleTimeString()
}

const addMessage = () => {
  const isUser = Math.random() > 0.5
  const messages = [
    'ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ',
    'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ã€‚',
    'æˆ‘æ­£åœ¨å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç»„ä»¶ã€‚',
    'æ„Ÿè°¢ä½ çš„è€å¿ƒæŒ‡å¯¼ï¼',
    'è¿™ä¸ªç»„ä»¶åŠŸèƒ½å¾ˆå¼ºå¤§å‘¢ã€‚'
  ]
  
  const newMessage = {
    content: messages[Math.floor(Math.random() * messages.length)],
    placement: isUser ? 'end' : 'start',
    avatar: isUser 
      ? { text: 'U', backgroundColor: '#52c41a' }
      : { text: 'AI', backgroundColor: '#1890ff' },
    typing: !isUser ? { step: 1, interval: 50 } : false,
    loading: false
  }
  
  chatMessages.value.push(newMessage)
}

const clearMessages = () => {
  chatMessages.value = []
}

const onMessageTypingComplete = (index) => {
  console.log(`æ¶ˆæ¯ ${index} æ‰“å­—å®Œæˆ`)
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  updateTime()
  setInterval(updateTime, 1000)
  
  // åˆå§‹åŒ–ä¸€äº›æ¶ˆæ¯
  chatMessages.value = [
    {
      content: 'æ¬¢è¿ä½¿ç”¨ zx-ai-bubble ç»„ä»¶ï¼',
      placement: 'start',
      avatar: { text: 'AI', backgroundColor: '#1890ff' },
      typing: { step: 2, interval: 80 },
      loading: false
    },
    {
      content: 'è¿™ä¸ªç»„ä»¶çœ‹èµ·æ¥å¾ˆä¸é”™ï¼',
      placement: 'end',
      avatar: { text: 'U', backgroundColor: '#52c41a' },
      typing: false,
      loading: false
    }
  ]
})
</script>

<style lang="scss" scoped>
.bubble-demo {
  padding: 32rpx;
  background-color: #f5f5f5;
  min-height: 100vh;
}

.demo-section {
  margin-bottom: 64rpx;
  background-color: #fff;
  border-radius: 16rpx;
  padding: 32rpx;
  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
}

.section-title {
  font-size: 36rpx;
  font-weight: 600;
  color: #262626;
  margin-bottom: 32rpx;
  padding-bottom: 16rpx;
  border-bottom: 2rpx solid #f0f0f0;
}

.demo-controls {
  margin-top: 32rpx;
  display: flex;
  gap: 16rpx;
  flex-wrap: wrap;
}

.demo-button {
  padding: 16rpx 32rpx;
  background-color: #1890ff;
  color: #fff;
  border: none;
  border-radius: 8rpx;
  font-size: 28rpx;
  cursor: pointer;
  transition: background-color 0.3s;
  
  &:hover {
    background-color: #40a9ff;
  }
  
  &:active {
    background-color: #096dd9;
  }
}

.custom-avatar {
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32rpx;
}

.custom-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  
  .header-name {
    font-weight: 600;
    color: #262626;
    font-size: 28rpx;
  }
  
  .header-time {
    font-size: 24rpx;
    color: #8c8c8c;
  }
}

.custom-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  
  .footer-info {
    font-size: 24rpx;
    color: #8c8c8c;
  }
  
  .footer-status {
    font-size: 24rpx;
    color: #52c41a;
  }
}

.chat-list {
  max-height: 800rpx;
  overflow-y: auto;
  padding: 16rpx;
  background-color: #fafafa;
  border-radius: 12rpx;
  border: 2rpx solid #f0f0f0;
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.chat-list::-webkit-scrollbar {
  width: 8rpx;
}

.chat-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4rpx;
}

.chat-list::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4rpx;
}

.chat-list::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style>