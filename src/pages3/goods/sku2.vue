<template>
  <view class="container">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <zx-navbar title="å•†å“è§„æ ¼é€‰æ‹©å™¨ 2.0" />
    
    <!-- ç¤ºä¾‹åˆ—è¡¨ -->
    <view class="demo-list">
      <!-- åŸºç¡€ç”¨æ³• -->
      <view class="demo-item">
        <view class="demo-title">åŸºç¡€ç”¨æ³•</view>
        <view class="demo-desc">æœ€åŸºæœ¬çš„å•†å“è§„æ ¼é€‰æ‹©åŠŸèƒ½</view>
        <zx-button type="primary" @click="showBasicSku">æ‰“å¼€åŸºç¡€è§„æ ¼é€‰æ‹©</zx-button>
      </view>

      <!-- å›¾ç‰‡è§„æ ¼ -->
      <view class="demo-item">
        <view class="demo-title">å›¾ç‰‡è§„æ ¼</view>
        <view class="demo-desc">æ”¯æŒå›¾ç‰‡å±•ç¤ºçš„è§„æ ¼é€‰æ‹©</view>
        <zx-button type="primary" @click="showImageSku">æ‰“å¼€å›¾ç‰‡è§„æ ¼é€‰æ‹©</zx-button>
      </view>

      <!-- è§„æ ¼è”åŠ¨ -->
      <view class="demo-item">
        <view class="demo-title">è§„æ ¼è”åŠ¨</view>
        <view class="demo-desc">æ™ºèƒ½è”åŠ¨ï¼Œè‡ªåŠ¨ç¦ç”¨ä¸å¯é€‰ç»„åˆ</view>
        <zx-button type="primary" @click="showLinkSku">æ‰“å¼€è”åŠ¨è§„æ ¼é€‰æ‹©</zx-button>
      </view>

      <!-- åº“å­˜é¢„è­¦ -->
      <view class="demo-item">
        <view class="demo-title">åº“å­˜é¢„è­¦</view>
        <view class="demo-desc">åº“å­˜ä¸è¶³æ—¶æ˜¾ç¤ºé¢„è­¦ä¿¡æ¯</view>
        <zx-button type="primary" @click="showStockSku">æ‰“å¼€åº“å­˜é¢„è­¦ç¤ºä¾‹</zx-button>
      </view>

      <!-- æœåŠ¡ä¿éšœ -->
      <view class="demo-item">
        <view class="demo-title">æœåŠ¡ä¿éšœ</view>
        <view class="demo-desc">å±•ç¤ºå•†å“æœåŠ¡ä¿éšœä¿¡æ¯</view>
        <zx-button type="primary" @click="showServiceSku">æ‰“å¼€æœåŠ¡ä¿éšœç¤ºä¾‹</zx-button>
      </view>

      <!-- è‡ªå®šä¹‰æŒ‰é’® -->
      <view class="demo-item">
        <view class="demo-title">è‡ªå®šä¹‰æŒ‰é’®</view>
        <view class="demo-desc">è‡ªå®šä¹‰åº•éƒ¨æ“ä½œæŒ‰é’®</view>
        <zx-button type="primary" @click="showCustomBtnSku">æ‰“å¼€è‡ªå®šä¹‰æŒ‰é’®ç¤ºä¾‹</zx-button>
      </view>

      <!-- å®Œæ•´ç¤ºä¾‹ -->
      <view class="demo-item">
        <view class="demo-title">å®Œæ•´ç¤ºä¾‹</view>
        <view class="demo-desc">åŒ…å«æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´ç¤ºä¾‹</view>
        <zx-button type="primary" @click="showCompleteSku">æ‰“å¼€å®Œæ•´ç¤ºä¾‹</zx-button>
      </view>
    </view>

    <!-- åŸºç¡€ç”¨æ³• -->
    <zx-goods-sku2
      v-model:show="basicVisible"
      :sku="basicSkuData"
      :goods="basicGoodsData"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
      @sku-complete="onSkuComplete"
    />

    <!-- å›¾ç‰‡è§„æ ¼ -->
    <zx-goods-sku2
      v-model:show="imageVisible"
      :sku="imageSkuData"
      :goods="imageGoodsData"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
    />

    <!-- è§„æ ¼è”åŠ¨ -->
    <zx-goods-sku2
      v-model:show="linkVisible"
      :sku="linkSkuData"
      :goods="linkGoodsData"
      :enable-sku-link="true"
      :sku-combinations="skuCombinations"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
      @stock-shortage="onStockShortage"
    />

    <!-- åº“å­˜é¢„è­¦ -->
    <zx-goods-sku2
      v-model:show="stockVisible"
      :sku="stockSkuData"
      :goods="stockGoodsData"
      :show-stock="true"
      :stock-threshold="5"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
      @stock-shortage="onStockShortage"
    />

    <!-- æœåŠ¡ä¿éšœ -->
    <zx-goods-sku2
      v-model:show="serviceVisible"
      :sku="serviceSkuData"
      :goods="serviceGoodsData"
      :services="serviceList"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
    />

    <!-- è‡ªå®šä¹‰æŒ‰é’® -->
    <zx-goods-sku2
      v-model:show="customBtnVisible"
      :sku="customBtnSkuData"
      :goods="customBtnGoodsData"
      :btn-options="['buy', 'cart']"
      buy-text="ç«‹å³è´­ä¹°"
      add-cart-text="åŠ å…¥è´­ç‰©è½¦"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
    >
      <template #sku-select-top>
        <view class="custom-tip">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">é€‰æ‹©æ‚¨å–œæ¬¢çš„è§„æ ¼ç»„åˆ</text>
        </view>
      </template>
      
      <template #sku-stepper-bottom>
        <view class="custom-promotion">
          <text class="promotion-text">ğŸ‰ æ»¡99å…ƒåŒ…é‚®ï¼Œæ»¡199å…ƒé€èµ å“</text>
        </view>
      </template>
    </zx-goods-sku2>

    <!-- å®Œæ•´ç¤ºä¾‹ -->
    <zx-goods-sku2
      v-model:show="completeVisible"
      :sku="completeSkuData"
      :goods="completeGoodsData"
      :enable-sku-link="true"
      :sku-combinations="completeCombinations"
      :services="completeServiceList"
      :btn-options="['buy', 'cart']"
      :show-stock="true"
      :stock-threshold="10"
      buy-text="ç«‹å³è´­ä¹°"
      add-cart-text="åŠ å…¥è´­ç‰©è½¦"
      btn-extra-text="æ”¯æŒ7å¤©æ— ç†ç”±é€€æ¢"
      @select-sku="onSelectSku"
      @click-btn-operate="onClickBtnOperate"
      @sku-complete="onSkuComplete"
      @stock-shortage="onStockShortage"
    >
      <template #sku-select-top>
        <view class="complete-tip">
          <view class="tip-row">
            <text class="tip-icon">ğŸ”¥</text>
            <text class="tip-text">é™æ—¶ç‰¹æƒ ï¼Œä»…å‰©24å°æ—¶</text>
          </view>
          <view class="tip-row">
            <text class="tip-icon">â­</text>
            <text class="tip-text">å·²æœ‰1000+ç”¨æˆ·è´­ä¹°</text>
          </view>
        </view>
      </template>
    </zx-goods-sku2>

    <!-- æ¶ˆæ¯æç¤º -->
    <zx-toast ref="toast" />
  </view>
</template>

<script setup>
import { ref } from 'vue'

// é¡µé¢æ•°æ®
const toast = ref()

// åŸºç¡€ç”¨æ³•
const basicVisible = ref(false)
const basicSkuData = ref([
  {
    id: 1,
    name: 'é¢œè‰²',
    required: true,
    list: [
      { id: 101, name: 'é»‘è‰²', active: false, disabled: false },
      { id: 102, name: 'ç™½è‰²', active: false, disabled: false },
      { id: 103, name: 'çº¢è‰²', active: false, disabled: false }
    ]
  },
  {
    id: 2,
    name: 'å°ºå¯¸',
    required: true,
    list: [
      { id: 201, name: 'S', active: false, disabled: false },
      { id: 202, name: 'M', active: false, disabled: false },
      { id: 203, name: 'L', active: false, disabled: false }
    ]
  }
])

const basicGoodsData = ref({
  title: 'æ—¶å°šä¼‘é—²Tæ¤',
  image: '/static/demo/goods1.jpg',
  price: '99.00',
  originalPrice: '199.00',
  stock: 100
})

// å›¾ç‰‡è§„æ ¼
const imageVisible = ref(false)
const imageSkuData = ref([
  {
    id: 1,
    name: 'é¢œè‰²',
    required: true,
    list: [
      { 
        id: 101, 
        name: 'ç»å…¸é»‘', 
        image: '/static/demo/color-black.jpg',
        active: false, 
        disabled: false 
      },
      { 
        id: 102, 
        name: 'çç ç™½', 
        image: '/static/demo/color-white.jpg',
        active: false, 
        disabled: false 
      },
      { 
        id: 103, 
        name: 'ç«ç‘°é‡‘', 
        image: '/static/demo/color-gold.jpg',
        active: false, 
        disabled: false 
      }
    ]
  },
  {
    id: 2,
    name: 'ç‰ˆæœ¬',
    required: true,
    list: [
      { id: 201, name: 'æ ‡å‡†ç‰ˆ', active: false, disabled: false },
      { id: 202, name: 'ä¸“ä¸šç‰ˆ', active: false, disabled: false },
      { id: 203, name: 'æ——èˆ°ç‰ˆ', active: false, disabled: false }
    ]
  }
])

const imageGoodsData = ref({
  title: 'æ™ºèƒ½æ‰‹æœº Pro Max',
  image: '/static/demo/phone.jpg',
  price: '6999.00',
  originalPrice: '7999.00',
  stock: 50
})

// è§„æ ¼è”åŠ¨
const linkVisible = ref(false)
const linkSkuData = ref([
  {
    id: 1,
    name: 'é¢œè‰²',
    required: true,
    list: [
      { id: 101, name: 'é»‘è‰²', active: false, disabled: false },
      { id: 102, name: 'ç™½è‰²', active: false, disabled: false },
      { id: 103, name: 'è“è‰²', active: false, disabled: false }
    ]
  },
  {
    id: 2,
    name: 'å†…å­˜',
    required: true,
    list: [
      { id: 201, name: '128GB', active: false, disabled: false },
      { id: 202, name: '256GB', active: false, disabled: false },
      { id: 203, name: '512GB', active: false, disabled: false }
    ]
  }
])

const linkGoodsData = ref({
  title: 'æ™ºèƒ½æ‰‹æœºè”åŠ¨ç¤ºä¾‹',
  image: '/static/demo/phone2.jpg',
  price: '3999.00',
  stock: 30
})

const skuCombinations = ref([
  {
    skuIds: [101, 201], // é»‘è‰² + 128GB
    price: '3999.00',
    stock: 10
  },
  {
    skuIds: [101, 202], // é»‘è‰² + 256GB
    price: '4499.00',
    stock: 15
  },
  {
    skuIds: [102, 201], // ç™½è‰² + 128GB
    price: '3999.00',
    stock: 0 // æ— åº“å­˜
  },
  {
    skuIds: [102, 202], // ç™½è‰² + 256GB
    price: '4499.00',
    stock: 8
  },
  {
    skuIds: [103, 203], // è“è‰² + 512GB
    price: '5999.00',
    stock: 5
  }
  // æ³¨æ„ï¼šå…¶ä»–ç»„åˆä¸å­˜åœ¨ï¼Œä¼šè¢«è‡ªåŠ¨ç¦ç”¨
])

// åº“å­˜é¢„è­¦
const stockVisible = ref(false)
const stockSkuData = ref([
  {
    id: 1,
    name: 'å°ºå¯¸',
    required: true,
    list: [
      { id: 101, name: 'S', active: false, disabled: false },
      { id: 102, name: 'M', active: false, disabled: false },
      { id: 103, name: 'L', active: false, disabled: false }
    ]
  }
])

const stockGoodsData = ref({
  title: 'é™é‡ç‰ˆè¿å¸½è¡«',
  image: '/static/demo/hoodie.jpg',
  price: '299.00',
  originalPrice: '399.00',
  stock: 3 // åº“å­˜å¾ˆå°‘
})

// æœåŠ¡ä¿éšœ
const serviceVisible = ref(false)
const serviceSkuData = ref([
  {
    id: 1,
    name: 'é¢œè‰²',
    required: true,
    list: [
      { id: 101, name: 'é»‘è‰²', active: false, disabled: false },
      { id: 102, name: 'ç™½è‰²', active: false, disabled: false }
    ]
  }
])

const serviceGoodsData = ref({
  title: 'é«˜ç«¯å•†åŠ¡åŒ…',
  image: '/static/demo/bag.jpg',
  price: '899.00',
  originalPrice: '1299.00',
  stock: 20
})

const serviceList = ref([
  { icon: 'ğŸ›¡ï¸', text: '7å¤©æ— ç†ç”±é€€æ¢' },
  { icon: 'ğŸšš', text: 'å…¨å›½åŒ…é‚®' },
  { icon: 'ğŸ“', text: '24å°æ—¶å®¢æœ' },
  { icon: 'âœ…', text: 'æ­£å“ä¿è¯' },
  { icon: 'ğŸ”’', text: 'éšç§ä¿æŠ¤' },
  { icon: 'âš¡', text: 'é—ªç”µå‘è´§' }
])

// è‡ªå®šä¹‰æŒ‰é’®
const customBtnVisible = ref(false)
const customBtnSkuData = ref([
  {
    id: 1,
    name: 'æ¬¾å¼',
    required: true,
    list: [
      { id: 101, name: 'ç»å…¸æ¬¾', active: false, disabled: false },
      { id: 102, name: 'æ—¶å°šæ¬¾', active: false, disabled: false },
      { id: 103, name: 'è¿åŠ¨æ¬¾', active: false, disabled: false }
    ]
  }
])

const customBtnGoodsData = ref({
  title: 'å¤šåŠŸèƒ½è¿åŠ¨é‹',
  image: '/static/demo/shoes.jpg',
  price: '599.00',
  originalPrice: '799.00',
  stock: 50
})

// å®Œæ•´ç¤ºä¾‹
const completeVisible = ref(false)
const completeSkuData = ref([
  {
    id: 1,
    name: 'é¢œè‰²',
    required: true,
    list: [
      { 
        id: 101, 
        name: 'æ˜Ÿç©ºé»‘', 
        image: '/static/demo/watch-black.jpg',
        active: false, 
        disabled: false 
      },
      { 
        id: 102, 
        name: 'æœˆå…‰é“¶', 
        image: '/static/demo/watch-silver.jpg',
        active: false, 
        disabled: false 
      },
      { 
        id: 103, 
        name: 'ç«ç‘°é‡‘', 
        image: '/static/demo/watch-gold.jpg',
        active: false, 
        disabled: false 
      }
    ]
  },
  {
    id: 2,
    name: 'è¡¨å¸¦',
    required: true,
    list: [
      { id: 201, name: 'è¿åŠ¨è¡¨å¸¦', active: false, disabled: false },
      { id: 202, name: 'çš®è´¨è¡¨å¸¦', active: false, disabled: false },
      { id: 203, name: 'é‡‘å±è¡¨å¸¦', active: false, disabled: false }
    ]
  },
  {
    id: 3,
    name: 'å°ºå¯¸',
    required: true,
    list: [
      { id: 301, name: '40mm', active: false, disabled: false },
      { id: 302, name: '44mm', active: false, disabled: false }
    ]
  }
])

const completeGoodsData = ref({
  title: 'æ™ºèƒ½æ‰‹è¡¨ Ultra',
  image: '/static/demo/watch.jpg',
  price: '2999.00',
  originalPrice: '3999.00',
  stock: 25
})

const completeCombinations = ref([
  {
    skuIds: [101, 201, 301], // æ˜Ÿç©ºé»‘ + è¿åŠ¨è¡¨å¸¦ + 40mm
    price: '2999.00',
    stock: 15
  },
  {
    skuIds: [101, 201, 302], // æ˜Ÿç©ºé»‘ + è¿åŠ¨è¡¨å¸¦ + 44mm
    price: '3199.00',
    stock: 12
  },
  {
    skuIds: [102, 202, 301], // æœˆå…‰é“¶ + çš®è´¨è¡¨å¸¦ + 40mm
    price: '3299.00',
    stock: 8
  },
  {
    skuIds: [102, 202, 302], // æœˆå…‰é“¶ + çš®è´¨è¡¨å¸¦ + 44mm
    price: '3499.00',
    stock: 6
  },
  {
    skuIds: [103, 203, 302], // ç«ç‘°é‡‘ + é‡‘å±è¡¨å¸¦ + 44mm
    price: '3999.00',
    stock: 3
  }
])

const completeServiceList = ref([
  { icon: 'ğŸ›¡ï¸', text: '2å¹´è´¨ä¿' },
  { icon: 'ğŸšš', text: 'é¡ºä¸°åŒ…é‚®' },
  { icon: 'ğŸ“', text: 'ä¸“å±å®¢æœ' },
  { icon: 'âœ…', text: 'å®˜æ–¹æ­£å“' },
  { icon: 'ğŸ”„', text: '30å¤©æ¢æ–°' },
  { icon: 'âš¡', text: 'å½“æ—¥å‘è´§' }
])

// æ–¹æ³•
function showBasicSku() {
  basicVisible.value = true
}

function showImageSku() {
  imageVisible.value = true
}

function showLinkSku() {
  linkVisible.value = true
}

function showStockSku() {
  stockVisible.value = true
}

function showServiceSku() {
  serviceVisible.value = true
}

function showCustomBtnSku() {
  customBtnVisible.value = true
}

function showCompleteSku() {
  completeVisible.value = true
}

function onSelectSku(data) {
  console.log('é€‰æ‹©è§„æ ¼:', data)
}

function onClickBtnOperate(data) {
  console.log('ç‚¹å‡»æ“ä½œæŒ‰é’®:', data)
  
  let message = ''
  switch (data.type) {
    case 'buy':
      message = `ç«‹å³è´­ä¹° ${data.value} ä»¶å•†å“`
      break
    case 'cart':
      message = `å·²åŠ å…¥è´­ç‰©è½¦ ${data.value} ä»¶å•†å“`
      break
    case 'confirm':
    default:
      message = `ç¡®è®¤é€‰æ‹© ${data.value} ä»¶å•†å“`
      break
  }
  
  toast.value?.show({
    type: 'success',
    message: message
  })
}

function onSkuComplete(data) {
  console.log('è§„æ ¼é€‰æ‹©å®Œæˆ:', data)
  toast.value?.show({
    type: 'success',
    message: 'è§„æ ¼é€‰æ‹©å®Œæˆï¼'
  })
}

function onStockShortage(data) {
  console.log('åº“å­˜ä¸è¶³:', data)
  toast.value?.show({
    type: 'warning',
    message: `åº“å­˜ä¸è¶³ï¼ä»…å‰© ${data.available} ä»¶`
  })
}
</script>

<style lang="scss" scoped>
.container {
  min-height: 100vh;
  background-color: #f8f9fa;
}

.demo-list {
  padding: 32rpx;
}

.demo-item {
  background-color: #fff;
  border-radius: 16rpx;
  padding: 32rpx;
  margin-bottom: 24rpx;
  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);
}

.demo-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #333;
  margin-bottom: 12rpx;
}

.demo-desc {
  font-size: 26rpx;
  color: #666;
  margin-bottom: 24rpx;
  line-height: 1.5;
}

// è‡ªå®šä¹‰æ’æ§½æ ·å¼
.custom-tip {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12rpx;
  padding: 24rpx;
  margin-bottom: 32rpx;
  display: flex;
  align-items: center;
}

.tip-icon {
  font-size: 32rpx;
  margin-right: 16rpx;
}

.tip-text {
  font-size: 26rpx;
  color: #fff;
  flex: 1;
}

.custom-promotion {
  background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
  border-radius: 12rpx;
  padding: 20rpx;
  margin-top: 24rpx;
  text-align: center;
}

.promotion-text {
  font-size: 24rpx;
  color: #2d3436;
}

.complete-tip {
  background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
  border-radius: 12rpx;
  padding: 24rpx;
  margin-bottom: 32rpx;
}

.tip-row {
  display: flex;
  align-items: center;
  margin-bottom: 12rpx;
}

.tip-row:last-child {
  margin-bottom: 0;
}

.complete-tip .tip-icon {
  font-size: 28rpx;
  margin-right: 12rpx;
}

.complete-tip .tip-text {
  font-size: 24rpx;
  color: #fff;
  flex: 1;
}
</style>