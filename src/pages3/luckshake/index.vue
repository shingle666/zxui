<template>
  <view class="container">
    <scroll-view scroll-y style="flex: 1">
      <view class="content">
        <!-- åŸºç¡€ç”¨æ³• -->
        <view class="demo-section">
          <view class="demo-title">åŸºç¡€ç”¨æ³•</view>
          <view class="demo-desc">æœ€ç®€å•çš„æ‘‡ä¸€æ‘‡æŠ½å¥–ï¼Œæ”¯æŒæ‘‡æ™ƒè®¾å¤‡å’Œç‚¹å‡»è§¦å‘ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="basicLuckshake"
              :luck-width="'200px'"
              :luck-height="'160px'"
              @shake-event="onBasicShake"
              @click-shake="onBasicClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ basicGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ basicGame.totalScore }}</text>
            </view>
            
            <view v-if="basicGame.lastResult" class="result-info">
              <text>{{ basicGame.lastResult }}</text>
            </view>
          </view>
        </view>

        <!-- è‡ªå®šä¹‰å›¾ç‰‡ -->
        <view class="demo-section">
          <view class="demo-title">è‡ªå®šä¹‰çº¢åŒ…å›¾ç‰‡</view>
          <view class="demo-desc">å¯ä»¥è‡ªå®šä¹‰çº¢åŒ…çš„ä¸Šä¸‹ä¸¤éƒ¨åˆ†å›¾ç‰‡ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="customImageLuckshake"
              :luck-width="'250px'"
              :luck-height="'200px'"
              luck-img-top="/static/demo/redpacket-top.png"
              luck-img-bottom="/static/demo/redpacket-bottom.png"
              @shake-event="onCustomImageShake"
              @click-shake="onCustomImageClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ customImageGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ customImageGame.totalScore }}</text>
            </view>
            
            <view v-if="customImageGame.lastResult" class="result-info">
              <text>{{ customImageGame.lastResult }}</text>
            </view>
          </view>
        </view>

        <!-- è‡ªå®šä¹‰æ‰‹åŠ¿ -->
        <view class="demo-section">
          <view class="demo-title">è‡ªå®šä¹‰æ‰‹åŠ¿å›¾ç‰‡</view>
          <view class="demo-desc">å¯ä»¥è‡ªå®šä¹‰æ‰‹åŠ¿æç¤ºå›¾ç‰‡å’Œæ ·å¼ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="customPointerLuckshake"
              :luck-width="'180px'"
              :luck-height="'140px'"
              click-point="/static/demo/hand-gesture.png"
              :pointer-style="{
                width: '120px',
                height: '120px',
                borderRadius: '50%'
              }"
              @shake-event="onCustomPointerShake"
              @click-shake="onCustomPointerClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ customPointerGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ customPointerGame.totalScore }}</text>
            </view>
            
            <view v-if="customPointerGame.lastResult" class="result-info">
              <text>{{ customPointerGame.lastResult }}</text>
            </view>
          </view>
        </view>

        <!-- é«˜çµæ•åº¦ -->
        <view class="demo-section">
          <view class="demo-title">é«˜çµæ•åº¦æ‘‡æ™ƒ</view>
          <view class="demo-desc">è°ƒæ•´æ‘‡æ™ƒçµæ•åº¦ï¼Œæ›´å®¹æ˜“è§¦å‘æ‘‡ä¸€æ‘‡ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="sensitivityLuckshake"
              :luck-width="'200px'"
              :luck-height="'160px'"
              :shake-speed="60"
              :duration-animation="1500"
              @shake-event="onSensitivityShake"
              @click-shake="onSensitivityClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ sensitivityGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ sensitivityGame.totalScore }}</text>
            </view>
            
            <view v-if="sensitivityGame.lastResult" class="result-info">
              <text>{{ sensitivityGame.lastResult }}</text>
            </view>
            
            <view class="tip-info">
              <text>ğŸ’¡ çµæ•åº¦è®¾ç½®ä¸º 60ï¼Œæ›´å®¹æ˜“è§¦å‘</text>
            </view>
          </view>
        </view>

        <!-- ç¦ç”¨æ‰‹åŠ¿æç¤º -->
        <view class="demo-section">
          <view class="demo-title">ç¦ç”¨æ‰‹åŠ¿æç¤º</view>
          <view class="demo-desc">ä¸æ˜¾ç¤ºæ‰‹åŠ¿æç¤ºå›¾æ ‡ï¼Œæ›´ç®€æ´çš„ç•Œé¢ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="noPointerLuckshake"
              :luck-width="'200px'"
              :luck-height="'160px'"
              :click-point="false"
              @shake-event="onNoPointerShake"
              @click-shake="onNoPointerClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ noPointerGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ noPointerGame.totalScore }}</text>
            </view>
            
            <view v-if="noPointerGame.lastResult" class="result-info">
              <text>{{ noPointerGame.lastResult }}</text>
            </view>
          </view>
        </view>

        <!-- ä»…ç‚¹å‡»æ¨¡å¼ -->
        <view class="demo-section">
          <view class="demo-title">ä»…ç‚¹å‡»æ¨¡å¼</view>
          <view class="demo-desc">ç¦ç”¨æ‘‡ä¸€æ‘‡æ£€æµ‹ï¼Œåªæ”¯æŒç‚¹å‡»è§¦å‘ã€‚</view>
          <view class="demo-block">
            <zx-luckshake
              ref="clickOnlyLuckshake"
              :luck-width="'200px'"
              :luck-height="'160px'"
              :is-shake="false"
              @shake-event="onClickOnlyShake"
              @click-shake="onClickOnlyClick"
            >
            </zx-luckshake>
            
            <view class="game-info">
              <text>å‰©ä½™æ¬¡æ•°: {{ clickOnlyGame.remainCount }}</text>
              <text>æ€»å¾—åˆ†: {{ clickOnlyGame.totalScore }}</text>
            </view>
            
            <view v-if="clickOnlyGame.lastResult" class="result-info">
              <text>{{ clickOnlyGame.lastResult }}</text>
            </view>
            
            <view class="tip-info">
              <text>ğŸ’¡ å·²ç¦ç”¨æ‘‡ä¸€æ‘‡ï¼Œåªèƒ½ç‚¹å‡»è§¦å‘</text>
            </view>
          </view>
        </view>

        <!-- å®Œæ•´æ¸¸æˆç¤ºä¾‹ -->
        <view class="demo-section">
          <view class="demo-title">å®Œæ•´æ¸¸æˆç¤ºä¾‹</view>
          <view class="demo-desc">åŒ…å«æ¸¸æˆçŠ¶æ€ã€å¥–å“è®¾ç½®ã€ç»“æœå±•ç¤ºçš„å®Œæ•´ç¤ºä¾‹ã€‚</view>
          <view class="demo-block">
            <view class="game-container">
              <view class="game-header">
                <text class="game-title">æ‘‡ä¸€æ‘‡æŠ½å¥–</text>
                <view class="game-stats">
                  <text>å‰©ä½™: {{ fullGame.remainCount }}æ¬¡</text>
                  <text>å¾—åˆ†: {{ fullGame.totalScore }}</text>
                </view>
              </view>
              
              <zx-luckshake
                ref="fullGameLuckshake"
                :luck-width="'220px'"
                :luck-height="'180px'"
                :shake-speed="80"
                @shake-event="onFullGameShake"
                @click-shake="onFullGameClick"
              >
              </zx-luckshake>
              
              <view v-if="fullGame.isGameOver" class="game-over">
                <text class="game-over-title">æ¸¸æˆç»“æŸ</text>
                <text class="final-score">æœ€ç»ˆå¾—åˆ†: {{ fullGame.totalScore }}</text>
                <button class="restart-btn" @click="restartFullGame">é‡æ–°å¼€å§‹</button>
              </view>
              
              <view v-if="fullGame.lastPrize" class="prize-result">
                <text class="prize-text">ğŸ‰ {{ fullGame.lastPrize.name }}</text>
                <text class="prize-desc">{{ fullGame.lastPrize.desc }}</text>
              </view>
              
              <view class="prize-list">
                <text class="prize-list-title">å¥–å“åˆ—è¡¨:</text>
                <view v-for="(prize, index) in prizes" :key="index" class="prize-item">
                  <text class="prize-name">{{ prize.name }}</text>
                  <text class="prize-probability">{{ prize.probability }}%</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- é‡ç½®æŒ‰é’® -->
        <view class="demo-section">
          <view class="demo-title">æ“ä½œæŒ‰é’®</view>
          <view class="demo-desc">é‡ç½®æ‰€æœ‰æ¸¸æˆçŠ¶æ€ã€‚</view>
          <view class="demo-block">
            <button class="reset-btn" @click="resetAllGames">é‡ç½®æ‰€æœ‰æ¸¸æˆ</button>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</template>

<script setup>
import { ref, reactive } from 'vue'
import ZxLuckshake from '@/components/zx-luckshake/zx-luckshake.vue'

// å¥–å“é…ç½®
const prizes = [
  { name: 'ä¸€ç­‰å¥–', desc: 'è·å¾—100ç§¯åˆ†', score: 100, probability: 5 },
  { name: 'äºŒç­‰å¥–', desc: 'è·å¾—50ç§¯åˆ†', score: 50, probability: 15 },
  { name: 'ä¸‰ç­‰å¥–', desc: 'è·å¾—20ç§¯åˆ†', score: 20, probability: 30 },
  { name: 'è°¢è°¢å‚ä¸', desc: 'è·å¾—5ç§¯åˆ†', score: 5, probability: 50 }
]

// åŸºç¡€æ¸¸æˆçŠ¶æ€
const basicGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// è‡ªå®šä¹‰å›¾ç‰‡æ¸¸æˆçŠ¶æ€
const customImageGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// è‡ªå®šä¹‰æ‰‹åŠ¿æ¸¸æˆçŠ¶æ€
const customPointerGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// é«˜çµæ•åº¦æ¸¸æˆçŠ¶æ€
const sensitivityGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// ç¦ç”¨æ‰‹åŠ¿æ¸¸æˆçŠ¶æ€
const noPointerGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// ä»…ç‚¹å‡»æ¸¸æˆçŠ¶æ€
const clickOnlyGame = reactive({
  remainCount: 5,
  totalScore: 0,
  lastResult: ''
})

// å®Œæ•´æ¸¸æˆçŠ¶æ€
const fullGame = reactive({
  remainCount: 10,
  totalScore: 0,
  lastResult: '',
  lastPrize: null,
  isGameOver: false
})

// æŠ½å¥–é€»è¾‘
const drawPrize = () => {
  const random = Math.random() * 100
  let currentProbability = 0
  
  for (const prize of prizes) {
    currentProbability += prize.probability
    if (random <= currentProbability) {
      return prize
    }
  }
  
  return prizes[prizes.length - 1] // é»˜è®¤è¿”å›æœ€åä¸€ä¸ªå¥–å“
}

// å¤„ç†æ¸¸æˆé€»è¾‘
const handleGameLogic = (gameState, isShake = true) => {
  if (gameState.remainCount <= 0) {
    gameState.lastResult = 'æŠ½å¥–æ¬¡æ•°å·²ç”¨å®Œ'
    return
  }
  
  const prize = drawPrize()
  gameState.remainCount--
  gameState.totalScore += prize.score
  gameState.lastResult = `${isShake ? 'æ‘‡ä¸€æ‘‡' : 'ç‚¹å‡»'}è·å¾—: ${prize.name} (+${prize.score}åˆ†)`
  
  if (gameState === fullGame) {
    gameState.lastPrize = prize
    if (gameState.remainCount <= 0) {
      gameState.isGameOver = true
    }
  }
  
  // æ˜¾ç¤ºç»“æœæç¤º
  uni.showToast({
    title: prize.name,
    icon: 'success',
    duration: 1500
  })
}

// åŸºç¡€ç”¨æ³•äº‹ä»¶å¤„ç†
const onBasicShake = () => {
  handleGameLogic(basicGame, true)
}

const onBasicClick = () => {
  handleGameLogic(basicGame, false)
}

// è‡ªå®šä¹‰å›¾ç‰‡äº‹ä»¶å¤„ç†
const onCustomImageShake = () => {
  handleGameLogic(customImageGame, true)
}

const onCustomImageClick = () => {
  handleGameLogic(customImageGame, false)
}

// è‡ªå®šä¹‰æ‰‹åŠ¿äº‹ä»¶å¤„ç†
const onCustomPointerShake = () => {
  handleGameLogic(customPointerGame, true)
}

const onCustomPointerClick = () => {
  handleGameLogic(customPointerGame, false)
}

// é«˜çµæ•åº¦äº‹ä»¶å¤„ç†
const onSensitivityShake = () => {
  handleGameLogic(sensitivityGame, true)
}

const onSensitivityClick = () => {
  handleGameLogic(sensitivityGame, false)
}

// ç¦ç”¨æ‰‹åŠ¿äº‹ä»¶å¤„ç†
const onNoPointerShake = () => {
  handleGameLogic(noPointerGame, true)
}

const onNoPointerClick = () => {
  handleGameLogic(noPointerGame, false)
}

// ä»…ç‚¹å‡»äº‹ä»¶å¤„ç†
const onClickOnlyShake = () => {
  // è¿™ä¸ªä¸ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºç¦ç”¨äº†æ‘‡ä¸€æ‘‡
  handleGameLogic(clickOnlyGame, true)
}

const onClickOnlyClick = () => {
  handleGameLogic(clickOnlyGame, false)
}

// å®Œæ•´æ¸¸æˆäº‹ä»¶å¤„ç†
const onFullGameShake = () => {
  if (!fullGame.isGameOver) {
    handleGameLogic(fullGame, true)
  }
}

const onFullGameClick = () => {
  if (!fullGame.isGameOver) {
    handleGameLogic(fullGame, false)
  }
}

// é‡å¯å®Œæ•´æ¸¸æˆ
const restartFullGame = () => {
  fullGame.remainCount = 10
  fullGame.totalScore = 0
  fullGame.lastResult = ''
  fullGame.lastPrize = null
  fullGame.isGameOver = false
}

// é‡ç½®æ‰€æœ‰æ¸¸æˆ
const resetAllGames = () => {
  // é‡ç½®åŸºç¡€æ¸¸æˆ
  basicGame.remainCount = 5
  basicGame.totalScore = 0
  basicGame.lastResult = ''
  
  // é‡ç½®è‡ªå®šä¹‰å›¾ç‰‡æ¸¸æˆ
  customImageGame.remainCount = 5
  customImageGame.totalScore = 0
  customImageGame.lastResult = ''
  
  // é‡ç½®è‡ªå®šä¹‰æ‰‹åŠ¿æ¸¸æˆ
  customPointerGame.remainCount = 5
  customPointerGame.totalScore = 0
  customPointerGame.lastResult = ''
  
  // é‡ç½®é«˜çµæ•åº¦æ¸¸æˆ
  sensitivityGame.remainCount = 5
  sensitivityGame.totalScore = 0
  sensitivityGame.lastResult = ''
  
  // é‡ç½®ç¦ç”¨æ‰‹åŠ¿æ¸¸æˆ
  noPointerGame.remainCount = 5
  noPointerGame.totalScore = 0
  noPointerGame.lastResult = ''
  
  // é‡ç½®ä»…ç‚¹å‡»æ¸¸æˆ
  clickOnlyGame.remainCount = 5
  clickOnlyGame.totalScore = 0
  clickOnlyGame.lastResult = ''
  
  // é‡ç½®å®Œæ•´æ¸¸æˆ
  restartFullGame()
  
  uni.showToast({
    title: 'å·²é‡ç½®æ‰€æœ‰æ¸¸æˆ',
    icon: 'success'
  })
}
</script>

<style scoped>
.container {
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.content {
  padding: 20rpx;
}

.demo-section {
  margin-bottom: 60rpx;
  background: white;
  border-radius: 20rpx;
  padding: 30rpx;
  box-shadow: 0 8rpx 30rpx rgba(0, 0, 0, 0.1);
}

.demo-title {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 20rpx;
  text-align: center;
}

.demo-desc {
  font-size: 28rpx;
  color: #666;
  margin-bottom: 30rpx;
  text-align: center;
  line-height: 1.5;
}

.demo-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40rpx 20rpx;
  background: #f8f9fa;
  border-radius: 16rpx;
  min-height: 400rpx;
  justify-content: center;
}

.game-info {
  margin-top: 30rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10rpx;
}

.game-info text {
  font-size: 28rpx;
  color: #333;
  padding: 8rpx 16rpx;
  background: white;
  border-radius: 20rpx;
  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);
}

.result-info {
  margin-top: 20rpx;
  padding: 20rpx;
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  border-radius: 16rpx;
  box-shadow: 0 4rpx 15rpx rgba(79, 172, 254, 0.3);
}

.result-info text {
  color: white;
  font-size: 28rpx;
  font-weight: 500;
}

.tip-info {
  margin-top: 20rpx;
  padding: 16rpx 24rpx;
  background: #fff3cd;
  border: 2rpx solid #ffeaa7;
  border-radius: 12rpx;
}

.tip-info text {
  color: #856404;
  font-size: 24rpx;
}

/* å®Œæ•´æ¸¸æˆæ ·å¼ */
.game-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.game-header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30rpx;
  padding: 20rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16rpx;
}

.game-title {
  font-size: 32rpx;
  font-weight: bold;
  color: white;
}

.game-stats {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8rpx;
}

.game-stats text {
  font-size: 24rpx;
  color: white;
  background: rgba(255, 255, 255, 0.2);
  padding: 6rpx 12rpx;
  border-radius: 12rpx;
}

.game-over {
  margin-top: 30rpx;
  padding: 30rpx;
  background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
  border-radius: 20rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15rpx;
  box-shadow: 0 8rpx 25rpx rgba(255, 107, 107, 0.3);
}

.game-over-title {
  font-size: 32rpx;
  font-weight: bold;
  color: white;
}

.final-score {
  font-size: 28rpx;
  color: white;
}

.restart-btn {
  padding: 16rpx 32rpx;
  background: white;
  color: #ff6b6b;
  border: none;
  border-radius: 25rpx;
  font-size: 28rpx;
  font-weight: 500;
}

.prize-result {
  margin-top: 20rpx;
  padding: 25rpx;
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  border-radius: 16rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10rpx;
  box-shadow: 0 4rpx 15rpx rgba(252, 182, 159, 0.3);
}

.prize-text {
  font-size: 30rpx;
  font-weight: bold;
  color: #d63031;
}

.prize-desc {
  font-size: 26rpx;
  color: #636e72;
}

.prize-list {
  margin-top: 30rpx;
  width: 100%;
  padding: 20rpx;
  background: #f1f3f4;
  border-radius: 12rpx;
}

.prize-list-title {
  font-size: 26rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 15rpx;
  display: block;
}

.prize-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12rpx 0;
  border-bottom: 1rpx solid #e9ecef;
}

.prize-item:last-child {
  border-bottom: none;
}

.prize-name {
  font-size: 24rpx;
  color: #495057;
}

.prize-probability {
  font-size: 22rpx;
  color: #6c757d;
  background: #e9ecef;
  padding: 4rpx 8rpx;
  border-radius: 8rpx;
}

.reset-btn {
  width: 100%;
  padding: 25rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 16rpx;
  font-size: 32rpx;
  font-weight: 500;
  box-shadow: 0 8rpx 25rpx rgba(102, 126, 234, 0.3);
}

.reset-btn:active {
  transform: translateY(2rpx);
  box-shadow: 0 4rpx 15rpx rgba(102, 126, 234, 0.3);
}
</style>